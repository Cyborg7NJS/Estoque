<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Estoque - Loja de Roupas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <h1>Sistema de Gestão de Estoque</h1>
        <p>Loja de Roupas</p>
    </div>

    <div class="container">
        <div class="menu">
            <button class="menu-button" onclick="showSection('cadastrar')">Cadastrar Produto</button>
            <button class="menu-button" onclick="showSection('listar')">Listar Produtos</button>
            <button class="menu-button" onclick="showSection('atualizar')">Atualizar Produto</button>
            <button class="menu-button" onclick="showSection('remover')">Remover Produto</button>
            <button class="menu-button" onclick="showSection('venda')">Registrar Venda</button>
            <button class="menu-button" onclick="showSection('estoque-baixo')">Estoque Baixo</button>
            <button class="menu-button" onclick="showSection('relatorio-estoque')">Relatório Estoque</button>
            <button class="menu-button" onclick="showSection('relatorio-vendas')">Relatório Vendas</button>
        </div>

        <!-- Seção Cadastrar Produto -->
        <div id="cadastrar" class="section">
            <h2>Cadastrar Produto</h2>
            <form id="form-cadastrar">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" required>
                </div>
                <div class="form-group">
                    <label for="tamanho">Tamanho:</label>
                    <input type="text" id="tamanho" required>
                </div>
                <div class="form-group">
                    <label for="cor">Cor:</label>
                    <input type="text" id="cor" required>
                </div>
                <div class="form-group">
                    <label for="quantidade">Quantidade:</label>
                    <input type="number" id="quantidade" min="1" required>
                </div>
                <div class="form-group">
                    <label for="preco">Preço (R$):</label>
                    <input type="number" id="preco" min="0.01" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="limite">Limite Mínimo:</label>
                    <input type="number" id="limite" min="1" value="5">
                </div>
                <button type="submit">Cadastrar</button>
            </form>
            <div id="cadastrar-resultado"></div>
        </div>

        <!-- Seção Listar Produtos -->
        <div id="listar" class="section">
            <h2>Produtos em Estoque</h2>
            <table id="tabela-produtos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Tamanho</th>
                        <th>Cor</th>
                        <th>Quantidade</th>
                        <th>Preço</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Seção Atualizar Produto -->
        <div id="atualizar" class="section">
            <h2>Atualizar Produto</h2>
            <div class="form-group">
                <label for="atualizar-id">Selecione o Produto:</label>
                <select id="atualizar-id"></select>
            </div>
            <form id="form-atualizar">
                <div class="form-group">
                    <label for="atualizar-nome">Nome:</label>
                    <input type="text" id="atualizar-nome">
                </div>
                <div class="form-group">
                    <label for="atualizar-tamanho">Tamanho:</label>
                    <input type="text" id="atualizar-tamanho">
                </div>
                <div class="form-group">
                    <label for="atualizar-cor">Cor:</label>
                    <input type="text" id="atualizar-cor">
                </div>
                <div class="form-group">
                    <label for="atualizar-quantidade">Quantidade:</label>
                    <input type="number" id="atualizar-quantidade" min="0">
                </div>
                <div class="form-group">
                    <label for="atualizar-preco">Preço (R$):</label>
                    <input type="number" id="atualizar-preco" min="0.01" step="0.01">
                </div>
                <div class="form-group">
                    <label for="atualizar-limite">Limite Mínimo:</label>
                    <input type="number" id="atualizar-limite" min="1">
                </div>
                <button type="submit">Atualizar</button>
            </form>
            <div id="atualizar-resultado"></div>
        </div>

        <!-- Seção Remover Produto -->
        <div id="remover" class="section">
            <h2>Remover Produto</h2>
            <div class="form-group">
                <label for="remover-id">Selecione o Produto:</label>
                <select id="remover-id"></select>
            </div>
            <button id="btn-remover">Remover</button>
            <div id="remover-resultado"></div>
        </div>

        <!-- Seção Registrar Venda -->
        <div id="venda" class="section">
            <h2>Registrar Venda</h2>
            <div class="form-group">
                <label for="venda-produto">Selecione o Produto:</label>
                <select id="venda-produto"></select>
            </div>
            <div class="form-group">
                <label for="venda-quantidade">Quantidade:</label>
                <input type="number" id="venda-quantidade" min="1" value="1">
            </div>
            <button id="btn-adicionar-item">Adicionar ao Carrinho</button>
            
            <h3>Carrinho</h3>
            <div id="carrinho"></div>
            <div id="venda-total">Total: R$ 0,00</div>
            <button id="btn-finalizar-venda">Finalizar Venda</button>
            <div id="venda-resultado"></div>
        </div>

        <!-- Seção Estoque Baixo -->
        <div id="estoque-baixo" class="section">
            <h2>Produtos com Estoque Baixo</h2>
            <table id="tabela-estoque-baixo">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Tamanho</th>
                        <th>Cor</th>
                        <th>Quantidade</th>
                        <th>Limite</th>
                        <th>Preço</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Seção Relatório de Estoque -->
        <div id="relatorio-estoque" class="section">
            <h2>Relatório de Estoque</h2>
            <button id="btn-gerar-relatorio-estoque">Gerar Relatório</button>
            <div id="conteudo-relatorio-estoque" class="report"></div>
        </div>

        <!-- Seção Relatório de Vendas -->
        <div id="relatorio-vendas" class="section">
            <h2>Relatório de Vendas</h2>
            <div class="form-group">
                <label for="relatorio-data-inicio">Data Inicial:</label>
                <input type="date" id="relatorio-data-inicio">
            </div>
            <div class="form-group">
                <label for="relatorio-data-fim">Data Final:</label>
                <input type="date" id="relatorio-data-fim">
            </div>
            <button id="btn-gerar-relatorio-vendas">Gerar Relatório</button>
            <div id="conteudo-relatorio-vendas" class="report"></div>
        </div>
    </div>

    <script>
        // Simular armazenamento de dados (em uma aplicação real você conectaria ao backend Python)
        let produtos = []; // Lista de produtos vazia
let vendas = [];
let carrinho = [];
let ultimoIdProduto = 0;
let ultimoIdVenda = 0;

        // Função para mostrar uma seção específica
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            // Atualizar os dados das seções quando elas são mostradas
            if (sectionId === 'listar') {
                atualizarTabelaProdutos();
            } else if (sectionId === 'atualizar') {
                preencherSelectProdutos('atualizar-id');
            } else if (sectionId === 'remover') {
                preencherSelectProdutos('remover-id');
            } else if (sectionId === 'venda') {
                preencherSelectProdutos('venda-produto');
                atualizarCarrinho();
            } else if (sectionId === 'estoque-baixo') {
                atualizarTabelaEstoqueBaixo();
            }
        }

        // Função para preencher selects com produtos
        function preencherSelectProdutos(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione um produto</option>';
            
            produtos.forEach(produto => {
                const option = document.createElement('option');
                option.value = produto.id;
                option.textContent = `${produto.id} - ${produto.nome} (${produto.tamanho}, ${produto.cor}) - Qtd: ${produto.quantidade}`;
                select.appendChild(option);
            });
        }

        // Função para atualizar a tabela de produtos
        function atualizarTabelaProdutos() {
            const tbody = document.querySelector('#tabela-produtos tbody');
            tbody.innerHTML = '';
            
            produtos.forEach(produto => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${produto.id}</td>
                    <td>${produto.nome}</td>
                    <td>${produto.tamanho}</td>
                    <td>${produto.cor}</td>
                    <td>${produto.quantidade}</td>
                    <td>R$ ${produto.preco.toFixed(2)}</td>
                    <td class="${produto.quantidade < produto.limite_minimo ? 'status-low' : 'status-ok'}">
                        ${produto.quantidade < produto.limite_minimo ? 'ESTOQUE BAIXO' : 'OK'}
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para atualizar a tabela de produtos com estoque baixo
        function atualizarTabelaEstoqueBaixo() {
            const tbody = document.querySelector('#tabela-estoque-baixo tbody');
            tbody.innerHTML = '';
            
            const produtosEstoqueBaixo = produtos.filter(produto => produto.quantidade < produto.limite_minimo);
            
            if (produtosEstoqueBaixo.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Não há produtos com estoque baixo.</td></tr>';
                return;
            }
            
            produtosEstoqueBaixo.forEach(produto => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${produto.id}</td>
                    <td>${produto.nome}</td>
                    <td>${produto.tamanho}</td>
                    <td>${produto.cor}</td>
                    <td class="status-low">${produto.quantidade}</td>
                    <td>${produto.limite_minimo}</td>
                    <td>R$ ${produto.preco.toFixed(2)}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para atualizar o carrinho
        function atualizarCarrinho() {
            const carrinhoDiv = document.getElementById('carrinho');
            carrinhoDiv.innerHTML = '';
            
            if (carrinho.length === 0) {
                carrinhoDiv.innerHTML = '<p>Carrinho vazio</p>';
                document.getElementById('venda-total').textContent = 'Total: R$ 0,00';
                return;
            }
            
            let total = 0;
            
            carrinho.forEach((item, index) => {
                const produto = produtos.find(p => p.id === item.id);
                const subtotal = produto.preco * item.quantidade;
                total += subtotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item';
                itemDiv.innerHTML = `
                    <p><strong>${produto.nome}</strong> (${produto.tamanho}, ${produto.cor})</p>
                    <p>Quantidade: ${item.quantidade} | Preço: R$ ${produto.preco.toFixed(2)} | Subtotal: R$ ${subtotal.toFixed(2)}</p>
                    <button onclick="removerItemCarrinho(${index})">Remover</button>
                `;
                
                carrinhoDiv.appendChild(itemDiv);
            });
            
            document.getElementById('venda-total').textContent = `Total: R$ ${total.toFixed(2)}`;
        }

        // Função para remover item do carrinho
        function removerItemCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinho();
        }

        // Função para gerar relatório de estoque
        function gerarRelatorioEstoque() {
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            const horaAtual = new Date().toLocaleTimeString('pt-BR');
            
            let relatorio = `===== RELATÓRIO DE ESTOQUE =====\n`;
            relatorio += `Data: ${dataAtual} ${horaAtual}\n`;
            relatorio += `Total de produtos: ${produtos.length}\n\n`;
            
            produtos.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(produto => {
                const status = produto.quantidade < produto.limite_minimo ? "ESTOQUE BAIXO" : "OK";
                relatorio += `ID: ${produto.id} | ${produto.nome} | Tamanho: ${produto.tamanho} | Cor: ${produto.cor} | `;
                relatorio += `Quantidade: ${produto.quantidade} | Preço: R$ ${produto.preco.toFixed(2)} | Status: ${status}\n`;
            });
            
            return relatorio;
        }

        // Função para gerar relatório de vendas
        function gerarRelatorioVendas(dataInicio, dataFim) {
            if (vendas.length === 0) {
                return "Não há vendas registradas.";
            }
            
            let vendasFiltradas = vendas;
            
            if (dataInicio) {
                vendasFiltradas = vendasFiltradas.filter(venda => new Date(venda.data) >= new Date(dataInicio));
            }
            
            if (dataFim) {
                vendasFiltradas = vendasFiltradas.filter(venda => new Date(venda.data) <= new Date(dataFim));
            }
            
            if (vendasFiltradas.length === 0) {
                return "Não há vendas no período selecionado.";
            }
            
            const totalVendas = vendasFiltradas.reduce((total, venda) => total + venda.valorTotal, 0);
            
            let relatorio = `===== RELATÓRIO DE VENDAS =====\n`;
            relatorio += `Período: ${dataInicio ? new Date(dataInicio).toLocaleDateString('pt-BR') : 'Início'} `;
            relatorio += `a ${dataFim ? new Date(dataFim).toLocaleDateString('pt-BR') : 'Hoje'}\n`;
            relatorio += `Total de vendas: ${vendasFiltradas.length}\n`;
            relatorio += `Valor total: R$ ${totalVendas.toFixed(2)}\n\n`;
            
            vendasFiltradas.forEach(venda => {
                relatorio += `Venda #${venda.id} | Data: ${new Date(venda.data).toLocaleDateString('pt-BR')} ${new Date(venda.data).toLocaleTimeString('pt-BR')} | Valor: R$ ${venda.valorTotal.toFixed(2)}\n`;
                relatorio += "Produtos vendidos:\n";
                
                venda.itens.forEach(item => {
                    const produto = produtos.find(p => p.id === item.id) || 
                                    { nome: `Produto ID ${item.id} (não encontrado)`, tamanho: "?", cor: "?" };
                    relatorio += `  - ${item.quantidade}x ${produto.nome} (Tamanho: ${produto.tamanho}, Cor: ${produto.cor}) - R$ ${item.preco.toFixed(2)} cada\n`;
                });
                
                relatorio += "\n";
            });
            
            return relatorio;
        }

        // Inicializar eventos após carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar seção inicial
            showSection('listar');
            
            // Formulário de cadastro de produto
            document.getElementById('form-cadastrar').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nome = document.getElementById('nome').value;
                const tamanho = document.getElementById('tamanho').value;
                const cor = document.getElementById('cor').value;
                const quantidade = parseInt(document.getElementById('quantidade').value);
                const preco = parseFloat(document.getElementById('preco').value);
                const limite = parseInt(document.getElementById('limite').value);
                
                ultimoIdProduto++;
                
                const novoProduto = {
                    id: ultimoIdProduto,
                    nome: nome,
                    tamanho: tamanho,
                    cor: cor,
                    quantidade: quantidade,
                    preco: preco,
                    limite_minimo: limite
                };
                
                produtos.push(novoProduto);
                
                document.getElementById('cadastrar-resultado').innerHTML = `
                    <div class="success">
                        Produto cadastrado com sucesso: ID ${novoProduto.id} - ${novoProduto.nome}
                    </div>
                `;
                
                this.reset();
            });
            
            // Formulário de atualização de produto
            document.getElementById('atualizar-id').addEventListener('change', function() {
                const id = parseInt(this.value);
                
                if (!id) {
                    document.getElementById('form-atualizar').reset();
                    return;
                }
                
                const produto = produtos.find(p => p.id === id);
                
                if (produto) {
                    document.getElementById('atualizar-nome').value = produto.nome;
                    document.getElementById('atualizar-tamanho').value = produto.tamanho;
                    document.getElementById('atualizar-cor').value = produto.cor;
                    document.getElementById('atualizar-quantidade').value = produto.quantidade;
                    document.getElementById('atualizar-preco').value = produto.preco;
                    document.getElementById('atualizar-limite').value = produto.limite_minimo;
                }
            });
            
            document.getElementById('form-atualizar').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('atualizar-id').value);
                
                if (!id) {
                    document.getElementById('atualizar-resultado').innerHTML = `
                        <div class="alert">
                            Selecione um produto para atualizar.
                        </div>
                    `;
                    return;
                }
                
                const produto = produtos.find(p => p.id === id);
                
                if (produto) {
                    const nome = document.getElementById('atualizar-nome').value;
                    const tamanho = document.getElementById('atualizar-tamanho').value;
                    const cor = document.getElementById('atualizar-cor').value;
                    const quantidade = document.getElementById('atualizar-quantidade').value;
                    const preco = document.getElementById('atualizar-preco').value;
                    const limite = document.getElementById('atualizar-limite').value;
                    
                    if (nome) produto.nome = nome;
                    if (tamanho) produto.tamanho = tamanho;
                    if (cor) produto.cor = cor;
                    if (quantidade) produto.quantidade = parseInt(quantidade);
                    if (preco) produto.preco = parseFloat(preco);
                    if (limite) produto.limite_minimo = parseInt(limite);
                    
                    document.getElementById('atualizar-resultado').innerHTML = `
                        <div class="success">
                            Produto atualizado com sucesso: ID ${produto.id} - ${produto.nome}
                        </div>
                    `;
                }
            });
            
            // Botão de remover produto
            document.getElementById('btn-remover').addEventListener('click', function() {
                const id = parseInt(document.getElementById('remover-id').value);
                
                if (!id) {
                    document.getElementById('remover-resultado').innerHTML = `
                        <div class="alert">
                            Selecione um produto para remover.
                        </div>
                    `;
                    return;
                }
                
                const index = produtos.findIndex(p => p.id === id);
                
                if (index !== -1) {
                    const produtoRemovido = produtos[index];
                    produtos.splice(index, 1);
                    
                    document.getElementById('remover-resultado').innerHTML = `
                        <div class="success">
                            Produto removido com sucesso: ID ${produtoRemovido.id} - ${produtoRemovido.nome}
                        </div>
                    `;
                    
                    preencherSelectProdutos('remover-id');
                }
            });
            
            // Botão de adicionar item ao carrinho
            document.getElementById('btn-adicionar-item').addEventListener('click', function() {
                const id = parseInt(document.getElementById('venda-produto').value);
                const quantidade = parseInt(document.getElementById('venda-quantidade').value);
                
                if (!id) {
                    document.getElementById('venda-resultado').innerHTML = `
                        <div class="alert">
                            Selecione um produto para adicionar ao carrinho.
                        </div>
                    `;
                    return;
                }
                
                const produto = produtos.find(p => p.id === id);
                
                if (!produto) {
                    document.getElementById('venda-resultado').innerHTML = `
                        <div class="alert">
                            Produto não encontrado.
                        </div>
                    `;
                    return;
                }
                
                if (quantidade <= 0) {
                    document.getElementById('venda-resultado').innerHTML = `
                        <div class="alert">
                            A quantidade deve ser maior que zero.
                        </div>
                    `;
                    return;
                }
                
                if (quantidade > produto.quantidade) {
                    document.getElementById('venda-resultado').innerHTML = `
                        <div class="alert">
                            Quantidade insuficiente em estoque. Disponível: ${produto.quantidade}
                        </div>
                    `;
                    return;
                }
                
                // Verificar se o produto já está no carrinho
                const indexCarrinho = carrinho.findIndex(item => item.id === id);
                
                if (indexCarrinho !== -1) {
                    // Atualizar quantidade se já estiver no carrinho
                    const novaQuantidade = carrinho[indexCarrinho].quantidade + quantidade;
                    
                    if (novaQuantidade > produto.quantidade) {
                        document.getElementById('venda-resultado').innerHTML = `
                            <div class="alert">
                                Quantidade total excede o estoque disponível. Disponível: ${produto.quantidade}
                            </div>
                        `;
                        return;
                    }
                    
                    carrinho[indexCarrinho].quantidade = novaQuantidade;
                } else {
                    // Adicionar novo item ao carrinho
                    carrinho.push({
                        id: id,
                        quantidade: quantidade,
                        preco: produto.preco
                    });
                }
                
                document.getElementById('venda-resultado').innerHTML = `
                    <div class="success">
                        ${quantidade}x ${produto.nome} adicionado ao carrinho.
                    </div>
                `;
                
                document.getElementById('venda-quantidade').value = 1;
                atualizarCarrinho();
            });
            
            // Botão de finalizar venda
            document.getElementById('btn-finalizar-venda').addEventListener('click', function() {
                if (carrinho.length === 0) {
                    document.getElementById('venda-resultado').innerHTML = `
                        <div class="alert">
                            O carrinho está vazio.
                        </div>
                    `;
                    return;
                }
                
                // Verificar estoque novamente antes de finalizar
                let estoqueInsuficiente = false;
                
                carrinho.forEach(item => {
                    const produto = produtos.find(p => p.id === item.id);
                    if (produto.quantidade < item.quantidade) {
                        document.getElementById('venda-resultado').innerHTML = `
                            <div class="alert">
                                Estoque insuficiente para ${produto.nome}. Disponível: ${produto.quantidade}
                            </div>
                        `;
                        estoqueInsuficiente = true;
                        return;
                    }
                });
                
                if (estoqueInsuficiente) {
                    return;
                }
                
                // Calcular valor total
                let valorTotal = 0;
                
                carrinho.forEach(item => {
                    valorTotal += item.preco * item.quantidade;
                });
                
                // Diminuir quantidade no estoque
                carrinho.forEach(item => {
                    const produto = produtos.find(p => p.id === item.id);
                    produto.quantidade -= item.quantidade;
                });
                
                // Registrar venda
                ultimoIdVenda++;
                
                const novaVenda = {
                    id: ultimoIdVenda,
                    data: new Date(),
                    itens: JSON.parse(JSON.stringify(carrinho)), // Cópia profunda
                    valorTotal: valorTotal
                };
                
                vendas.push(novaVenda);
                
                // Limpar carrinho
                carrinho = [];
                atualizarCarrinho();
                
                // Mostrar resultado
                document.getElementById('venda-resultado').innerHTML = `
                    <div class="success">
                        Venda #${novaVenda.id} registrada com sucesso!<br>
                        Valor total: R$ ${valorTotal.toFixed(2)}<br>
                        Data: ${novaVenda.data.toLocaleDateString('pt-BR')} ${novaVenda.data.toLocaleTimeString('pt-BR')}
                    </div>
                `;
                
                // Verificar se algum produto ficou com estoque baixo
                let produtosBaixos = [];
                
                produtos.forEach(produto => {
                    if (produto.quantidade < produto.limite_minimo) {
                        produtosBaixos.push(produto);
                    }
                });
                
                if (produtosBaixos.length > 0) {
                    let alertaEstoque = `
                        <div class="alert">
                            <strong>ALERTA DE ESTOQUE BAIXO:</strong><br>
                    `;
                    
                    produtosBaixos.forEach(produto => {
                        alertaEstoque += `${produto.nome} (${produto.tamanho}, ${produto.cor}) - Quantidade: ${produto.quantidade}<br>`;
                    });
                    
                    alertaEstoque += `</div>`;
                    
                    document.getElementById('venda-resultado').innerHTML += alertaEstoque;
                }
                
                // Atualizar lista de produtos
                atualizarTabelaProdutos();
            });
            
            // Botão de gerar relatório de estoque
            document.getElementById('btn-gerar-relatorio-estoque').addEventListener('click', function() {
                const relatorio = gerarRelatorioEstoque();
                document.getElementById('conteudo-relatorio-estoque').textContent = relatorio;
            });
            
            // Botão de gerar relatório de vendas
            document.getElementById('btn-gerar-relatorio-vendas').addEventListener('click', function() {
                const dataInicio = document.getElementById('relatorio-data-inicio').value;
                const dataFim = document.getElementById('relatorio-data-fim').value;
                
                const relatorio = gerarRelatorioVendas(dataInicio, dataFim);
                document.getElementById('conteudo-relatorio-vendas').textContent = relatorio;
            });
        });
    </script>
</body>
</html>